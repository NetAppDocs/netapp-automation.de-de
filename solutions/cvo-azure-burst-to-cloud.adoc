---
sidebar: sidebar 
permalink: solutions/cvo-azure-burst-to-cloud.html 
keywords: bluexp automation hub, netapp automation solutions, azure, cloud volumes ontap, burst to cloud. netapp, console 
summary: Mit dieser Automatisierungsl√∂sung k√∂nnen Sie Cloud Volumes ONTAP f√ºr Azure unter Verwendung von Terraform implementieren. 
---
= Cloud Volumes ONTAP f√ºr Azure ‚Äì Burst in die Cloud
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
Dieser Artikel unterst√ºtzt die NetApp Cloud Volumes ONTAP for Azure Automation Solution, die NetApp -Kunden √ºber den NetApp Console Automation Hub zur Verf√ºgung steht.

Die Automatisierungsl√∂sung Cloud Volumes ONTAP f√ºr Azure automatisiert die Container-Implementierung von Cloud Volumes ONTAP f√ºr Azure mithilfe von Terraform, sodass Sie Cloud Volumes ONTAP f√ºr Azure schnell und ohne manuelles Eingreifen implementieren k√∂nnen.

.Bevor Sie beginnen
* Sie m√ºssen die link:https://console.netapp.com/automationHub["Cloud Volumes ONTAP Azure ‚Äì Burst in die Cloud"^] Automatisierungsl√∂sung √ºber die Web-Benutzeroberfl√§che der Konsole. Die L√∂sung ist verpackt als `CVO-Azure-Burst-To-Cloud.zip`Die
* Sie m√ºssen eine Linux-VM im gleichen Netzwerk wie Cloud Volumes ONTAP installieren.
* Nach der Installation der Linux-VM m√ºssen Sie die Schritte in dieser L√∂sung befolgen, um die erforderlichen Abh√§ngigkeiten zu installieren.




== Schritt: Installieren Sie Docker und Docker Compose



=== Installation Von Docker

Die folgenden Schritte verwenden Ubuntu 20.04 Debian Linux-Distributionssoftware als Beispiel. Die Befehle, die Sie ausf√ºhren, h√§ngen von der Linux-Distributionssoftware ab, die Sie verwenden. Informationen zur Konfiguration finden Sie in der Dokumentation der jeweiligen Linux-Distributionssoftware.

.Schritte
. Installieren Sie Docker, indem Sie die folgenden Befehle ausf√ºhren `sudo`:
+
[source, cli]
----
sudo apt-get update
sudo apt-get install apt-transport-https cacertificates curl gnupg-agent software-properties-common curl -fsSL https://download.docker.com/linux/ubuntu/gpg |
sudo apt-key add -
sudo add-apt-repository ‚Äúdeb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable‚Äù
sudo apt-get update
sudo apt-get install dockerce docker-ce-cli containerd.io
----
. √úberpr√ºfen Sie die Installation:
+
[source, cli]
----
docker ‚Äìversion
----
. Vergewissern Sie sich, dass auf Ihrem Linux-System eine Gruppe namens ‚ÄûDocker‚Äú erstellt wurde. Erstellen Sie bei Bedarf die Gruppe:
+
[source, cli]
----
sudo groupadd docker
----
. F√ºgen Sie den Benutzer hinzu, der der Gruppe Zugriff auf Docker ben√∂tigt:
+
[source, cli]
----
sudo usermod -aG docker $(whoami)
----
. Ihre √Ñnderungen werden √ºbernommen, nachdem Sie sich beim Terminal abmelden und wieder anmelden. Alternativ k√∂nnen Sie die √Ñnderungen sofort anwenden:
+
[source, cli]
----
newgrp docker
----




=== Installieren Sie Docker Compose

.Schritte
. Installieren Sie Docker Compose, indem Sie die folgenden Befehle ausf√ºhren `sudo`:
+
[source, cli]
----
sudo curl -L ‚Äúhttps://github.com/docker/compose/releases/download/1.29.2/dockercompose-(ùë¢ùëõùëéùëöùëí ‚àí ùë†)‚àí(uname -m)‚Äù -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
----
. √úberpr√ºfen Sie die Installation:
+
[source, cli]
----
docker-compose ‚Äìversion
----




== Schritt 2: Vorbereiten des Docker Images

.Schritte
. Kopieren Sie den `CVO-Azure-Burst-To-Cloud.zip` Ordner auf die Linux-VM, die Sie zum Bereitstellen von Cloud Volumes ONTAP verwenden m√∂chten:
+
[source, cli]
----
scp -i ~/<private-key>.pem -r CVO-Azure-Burst-To-Cloud.zip <azureuser>@<IP_ADDRESS_OF_VM>:<LOCATION_TO_BE_COPIED>
----
+
** `private-key.pem` Ist Ihre private Schl√ºsseldatei f√ºr die Anmeldung ohne Kennwort.
** `azureuser` Ist der VM-Benutzername.
** `IP_ADDRESS_OF_VM` Ist die VM IP-Adresse.
** `LOCATION_TO_BE_COPIED` Ist der Speicherort, an den der Ordner kopiert werden soll.


. Extrahieren Sie den `CVO-Azure-Burst-To-Cloud.zip` Ordner. Sie k√∂nnen den Ordner im aktuellen Verzeichnis oder an einem benutzerdefinierten Speicherort extrahieren.
+
Um den Ordner im aktuellen Verzeichnis zu extrahieren, f√ºhren Sie Folgendes aus:

+
[source, cli]
----
unzip CVO-Azure-Burst-To-Cloud.zip
----
+
Um den Ordner an einem benutzerdefinierten Speicherort zu extrahieren, f√ºhren Sie Folgendes aus:

+
[source, cli]
----
unzip CVO-Azure-Burst-To-Cloud.zip -d ~/<your_folder_name>
----
. Navigieren Sie nach dem Extrahieren des Inhalts zum Ordner, `CVO_Azure_Deployment` und f√ºhren Sie den folgenden Befehl aus, um die Dateien anzuzeigen:
+
[source, cli]
----
 ls -la
----
+
Sie sollten eine Liste von Dateien sehen, √§hnlich wie das folgende Beispiel:

+
[listing]
----
drwxr-xr-x@ 11 user1 staff 352 May 5 13:56 .
drwxr-xr-x@ 5 user1 staff 160 May 5 14:24 ..
-rw-r--r--@ 1 user1 staff 324 May 5 13:18 .env
-rw-r--r--@ 1 user1 staff 1449 May 5 13:18 Dockerfile
-rw-r--r--@ 1 user1 staff 35149 May 5 13:18 LICENSE
-rw-r--r--@ 1 user1 staff 13356 May 5 14:26 README.md
-rw-r--r-- 1  user1 staff 354318151 May 5 13:51 cvo_azure_flexcache_ubuntu_image_latest
drwxr-xr-x@ 4 user1 staff 128 May 5 13:18 cvo_azure_variables
-rw-r--r--@ 1 user1 staff 996 May 5 13:18 docker-compose-deploy.yml
-rw-r--r--@ 1 user1 staff 1041 May 5 13:18 docker-compose-destroy.yml
-rw-r--r--@ 1 user1 staff 4771 May 5 13:18 sp_role.json
----
. Suchen Sie die `cvo_azure_flexcache_ubuntu_image_latest.tar.gz` Datei. Dieses enth√§lt das Docker Image, das f√ºr die Implementierung von Cloud Volumes ONTAP f√ºr Azure erforderlich ist.
. Enttaren Sie die Datei:
+
[source, cli]
----
docker load -i cvo_azure_flexcache_ubuntu_image_latest.tar.gz
----
. Warten Sie einige Minuten, bis das Docker-Image geladen ist, und √ºberpr√ºfen Sie dann, ob das Docker-Image erfolgreich geladen wurde:
+
[source, cli]
----
docker images
----
+
Sie sollten ein Docker-Image mit dem `latest` Tag sehen `cvo_azure_flexcache_ubuntu_image_latest`, wie im folgenden Beispiel gezeigt:

+
[listing]
----
REPOSITORY TAG IMAGE ID CREATED SIZE
cvo_azure_flexcache_ubuntu_image latest 18db15a4d59c 2 weeks ago 1.14GB
----




== Schritt 3: Erstellen Sie variable Umgebungsdateien

In dieser Phase m√ºssen Sie zwei Umgebungsvariablendateien erstellen.  Eine Datei dient der Authentifizierung von Azure Resource Manager-APIs mithilfe der Anmeldeinformationen des Dienstprinzipals.  Die zweite Datei dient zum Festlegen von Umgebungsvariablen, damit die Terraform-Konsolenmodule Azure-APIs finden und authentifizieren k√∂nnen.

.Schritte
. Erstellen Sie einen Dienstprinzipal.
+
Bevor Sie die Umgebungsvariablen-Dateien erstellen k√∂nnen, m√ºssen Sie einen Dienstprinzipal erstellen, indem Sie die Schritte in befolgenlink:https://learn.microsoft.com/en-us/azure/active-directory/develop/howto-create-service-principal-portal["Erstellen Sie eine Azure Active Directory-Applikation und einen Dienstprinzipal, die auf Ressourcen zugreifen k√∂nnen"^].

. Weisen Sie die Rolle *Contributor* dem neu erstellten Service-Prinzipal zu.
. Erstellen Sie eine benutzerdefinierte Rolle.
+
.. Suchen Sie die `sp_role.json` Datei, und pr√ºfen Sie unter den aufgef√ºhrten Aktionen, ob die erforderlichen Berechtigungen vorhanden sind.
.. F√ºgen Sie diese Berechtigungen ein und h√§ngen Sie die benutzerdefinierte Rolle an den neu erstellten Dienstprinzipal an.


. Navigieren Sie zu *Certificates & Secrets* und w√§hlen Sie *New Client secret*, um das Client-Secret zu erstellen.
+
Wenn Sie das Client-Secret erstellen, m√ºssen Sie die Details aus der Spalte *Wert* aufzeichnen, da Sie diesen Wert nicht mehr sehen k√∂nnen. Au√üerdem m√ºssen Sie folgende Informationen erfassen:

+
** Client-ID
** Abonnement-ID
** Mandanten-ID
+
Sie ben√∂tigen diese Informationen, um die Umgebungsvariablen zu erstellen. Die Client-ID und die Mandanten-ID finden Sie im Abschnitt *√úbersicht* der Service Principal UI.



. Erstellen Sie die Umgebungsdateien.
+
.. Erstellen Sie die `azureauth.env` Datei an folgendem Speicherort:
+
`path/to/env-file/azureauth.env`

+
... F√ºgen Sie der Datei folgenden Inhalt hinzu:
+
ClientID=<> ClientSecret=<> SubscriptionID=<> tenantId=<>

+
Das Format *muss* genau wie oben dargestellt sein, ohne Leerzeichen zwischen Schl√ºssel und Wert.



.. Erstellen Sie die `credentials.env` Datei an folgendem Speicherort:
+
`path/to/env-file/credentials.env`

+
... F√ºgen Sie der Datei folgenden Inhalt hinzu:
+
AZURE_TENANT_ID=<> AZURE_CLIENT_SECRET=<> AZURE_CLIENT_ID=<> AZURE_SUBSCRIPTION_ID=<>

+
Das Format *muss* genau wie oben dargestellt sein, ohne Leerzeichen zwischen Schl√ºssel und Wert.





. F√ºgen Sie der Datei die absoluten Dateipfade hinzu `.env`.
+
Geben Sie den absoluten Pfad f√ºr die Umgebungsdatei in die `.env` Datei ein `azureauth.env`, die der Umgebungsvariable entspricht `AZURE_RM_CREDS`.

+
`AZURE_RM_CREDS=path/to/env-file/azureauth.env`

+
Geben Sie den absoluten Pfad f√ºr die Umgebungsdatei in die `.env` Datei ein `credentials.env`, die der Umgebungsvariable entspricht `BLUEXP_TF_AZURE_CREDS`.

+
`BLUEXP_TF_AZURE_CREDS=path/to/env-file/credentials.env`





== Schritt 4: Registrieren Sie sich f√ºr NetApp Intelligent Services

Melden Sie sich √ºber Ihren Cloud-Anbieter f√ºr NetApp Intelligent Services an und zahlen Sie stundenweise (PAYGO) oder √ºber einen Jahresvertrag. Zu den intelligenten Diensten von NetApp geh√∂ren NetApp Backup und Recovery, Cloud Volumes ONTAP, NetApp Cloud Tiering, NetApp Ransomware Resilience und NetApp Disaster Recovery. NetApp Data Classification ist ohne zus√§tzliche Kosten in Ihrem Abonnement enthalten

.Schritte
. Navigieren Sie im Azure-Portal zu *SaaS* und w√§hlen Sie * NetApp Intelligent Services abonnieren* aus.
. W√§hlen Sie den Plan *Cloud Manager (nach Cap PYGO nach Stunde, WORM und Datendiensten)* aus.
+
Sie k√∂nnen entweder dieselbe Ressourcengruppe wie Cloud Volumes ONTAP oder eine andere Ressourcengruppe verwenden.

. Konfigurieren Sie das Konsolenportal, um das SaaS-Abonnement in die Konsole zu importieren.
+
Sie k√∂nnen dies direkt √ºber das Azure-Portal konfigurieren, indem Sie zu *Produkt- und Plandetails* navigieren und die Option *Jetzt Konto konfigurieren* ausw√§hlen.

+
Sie werden dann zum Konsolenportal weitergeleitet, um die Konfiguration zu best√§tigen.

. Best√§tigen Sie die Konfiguration im Konsolenportal, indem Sie *Speichern* ausw√§hlen.




== Schritt 5: Erstellen Sie ein externes Volume

Sie sollten ein externes Volume erstellen, damit die Terraform-Statusdateien und andere wichtige Dateien erhalten bleiben. Sie m√ºssen sicherstellen, dass die Dateien f√ºr Terraform verf√ºgbar sind, um den Workflow und die Implementierungen auszuf√ºhren.

.Schritte
. Externes Volume au√üerhalb von Docker Compose erstellen:
+
[source, cli]
----
docker volume create ¬´ volume_name ¬ª
----
+
Beispiel:

+
[listing]
----
docker volume create cvo_azure_volume_dst
----
. Verwenden Sie eine der folgenden Optionen:
+
.. F√ºgen Sie einen externen Volume-Pfad zur Umgebungsdatei hinzu `.env`.
+
Sie m√ºssen das genaue unten dargestellte Format einhalten.

+
Format:

+
`PERSISTENT_VOL=path/to/external/volume:/cvo_azure`

+
Beispiel:
`PERSISTENT_VOL=cvo_azure_volume_dst:/cvo_azure`

.. F√ºgen Sie NFS-Freigaben als externes Volume hinzu.
+
Stellen Sie sicher, dass der Docker Container mit den NFS-Freigaben kommunizieren kann und dass die korrekten Berechtigungen wie Lese-/Schreibvorg√§nge konfiguriert sind.

+
... F√ºgen Sie den Pfad der NFS-Freigaben als Pfad zum externen Volume in der Docker Compose-Datei hinzu, wie unten gezeigt: Format:
+
`PERSISTENT_VOL=path/to/nfs/volume:/cvo_azure`

+
Beispiel:
`PERSISTENT_VOL=nfs/mnt/document:/cvo_azure`





. Navigieren Sie zum `cvo_azure_variables` Ordner.
+
Im Ordner sollten die folgenden Variablendateien angezeigt werden:

+
`terraform.tfvars`

+
`variables.tf`

. √Ñndern Sie die Werte innerhalb der `terraform.tfvars` Datei entsprechend Ihren Anforderungen.
+
Sie m√ºssen die spezifische Begleitdokumentation lesen, wenn Sie einen der Variablenwerte in der Datei √§ndern `terraform.tfvars`. Die Werte k√∂nnen je nach Region, Verf√ºgbarkeitszonen und anderen von Cloud Volumes ONTAP f√ºr Azure unterst√ºtzten Faktoren variieren. Dies umfasst Lizenzen, Festplattengr√∂√üe und VM-Gr√∂√üe f√ºr einzelne Nodes sowie Hochverf√ºgbarkeitspaare (HA).

+
Alle unterst√ºtzenden Variablen f√ºr den Konsolenagenten und die Cloud Volumes ONTAP Terraform-Module sind bereits in der `variables.tf` Datei.  Sie m√ºssen auf die Variablennamen in der `variables.tf` Datei vor dem Hinzuf√ºgen zur `terraform.tfvars` Datei.

. Je nach Ihren Anforderungen k√∂nnen Sie FlexCache und FlexClone aktivieren oder deaktivieren, indem Sie die folgenden Optionen auf oder `false` einstellen `true`.
+
Die folgenden Beispiele aktivieren FlexCache und FlexClone:

+
** `is_flexcache_required = true`
** `is_flexclone_required = true`


. Bei Bedarf k√∂nnen Sie den Wert f√ºr die Terraform-Variable aus dem Azure Active Directory-Dienst abrufen `az_service_principal_object_id`:
+
.. Navigieren Sie zu *Enterprise Applications ‚Äì> All Applications* und w√§hlen Sie den Namen des zuvor erstellten Service Principal aus.
.. Kopieren Sie die Objekt-ID, und f√ºgen Sie den Wert f√ºr die Terraform-Variable ein:
+
`az_service_principal_object_id`







== Schritt 6: Implementierung von Cloud Volumes ONTAP f√ºr Azure

Gehen Sie wie folgt vor, um Cloud Volumes ONTAP f√ºr Azure zu implementieren.

.Schritte
. F√ºhren Sie im Stammordner den folgenden Befehl aus, um die Bereitstellung auszul√∂sen:
+
[source, cli]
----
docker-compose up -d
----
+
Zwei Container werden ausgel√∂st, der erste Container implementiert Cloud Volumes ONTAP und der zweite Container sendet Telemetriedaten an AutoSupport.

+
Der zweite Container wartet, bis der erste Container alle Schritte erfolgreich abgeschlossen hat.

. √úberwachen Sie den Fortschritt des Bereitstellungsprozesses mithilfe der Protokolldateien:
+
[source, cli]
----
docker-compose logs -f
----
+
Dieser Befehl liefert die Ausgabe in Echtzeit und erfasst die Daten in den folgenden Protokolldateien:

+
`deployment.log`

+
`telemetry_asup.log`

+
Sie k√∂nnen den Namen dieser Protokolldateien √§ndern, indem Sie die Datei mithilfe der folgenden Umgebungsvariablen bearbeiten `.env`:

+
`DEPLOYMENT_LOGS`

+
`TELEMETRY_ASUP_LOGS`

+
Die folgenden Beispiele zeigen, wie Sie die Protokolldateinamen √§ndern:

+
`DEPLOYMENT_LOGS=<your_deployment_log_filename>.log`

+
`TELEMETRY_ASUP_LOGS=<your_telemetry_asup_log_filename>.log`



.Nachdem Sie fertig sind
Mit den folgenden Schritten k√∂nnen Sie die tempor√§re Umgebung entfernen und Elemente bereinigen, die w√§hrend des Bereitstellungsprozesses erstellt wurden.

.Schritte
. Wenn Sie FlexCache bereitgestellt haben, legen Sie die folgende Option in der `terraform.tfvars` Datei fest. Dadurch werden FlexCache-Volumes bereinigt und die zuvor erstellte tempor√§re Umgebung wird entfernt.
+
`flexcache_operation = "destroy"`

+

NOTE: Die m√∂glichen Optionen sind  `deploy` und `destroy`.

. Wenn Sie FlexClone bereitgestellt haben, legen Sie die folgende Option in der `terraform.tfvars` Datei fest. Dadurch werden FlexClone-Volumes bereinigt und die zuvor erstellte tempor√§re Umgebung wird entfernt.
+
`flexclone_operation = "destroy"`

+

NOTE: Die m√∂glichen Optionen sind `deploy` und `destroy`.


